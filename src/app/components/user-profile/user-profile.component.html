<div class="min-h-screen bg-gray-50 dark:bg-gray-950 py-4 sm:py-8">
  <div class="max-w-5xl mx-auto px-4">
    <!-- Back Button -->
    <button
      (click)="goBack()"
      class="mb-4 sm:mb-6 flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-jio-blue-500 dark:hover:text-jio-blue-400 transition-colors"
    >
      <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      <span class="text-sm sm:text-base">Back to Dashboard</span>
    </button>

    <!-- Page Title -->
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6 sm:mb-8">User Profile</h1>

    <!-- Profile Information Card -->
    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-4 sm:p-6 mb-4 sm:mb-6">
      <h2 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4 sm:mb-6">Profile Information</h2>

      <div class="flex flex-col sm:flex-row items-center sm:items-start gap-4 sm:gap-6">
        <!-- Profile Photo -->
        <div class="flex-shrink-0">
          <div class="relative">
            <img
              [src]="currentUser?.photoUrl"
              [alt]="currentUser?.firstName + ' ' + currentUser?.lastName"
              class="w-24 h-24 sm:w-32 sm:h-32 rounded-full border-4 border-jio-blue-500 shadow-lg object-cover"
            />
            <!-- Upload button overlay -->
            <button
              (click)="triggerPhotoUpload()"
              class="absolute bottom-0 right-0 p-1.5 sm:p-2 bg-jio-blue-500 text-white rounded-full shadow-lg hover:bg-jio-blue-600 transition-colors"
              title="Upload photo"
            >
              <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
            </button>
            <!-- Hidden file input -->
            <input
              type="file"
              id="photoUpload"
              accept="image/*"
              (change)="onPhotoUpload($event)"
              class="hidden"
            />
          </div>
        </div>

        <!-- Profile Details -->
        <div class="flex-1 w-full grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
          <div>
            <label class="block text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">First Name</label>
            <p class="text-base sm:text-lg text-gray-900 dark:text-gray-100">{{ currentUser?.firstName }}</p>
          </div>

          <div>
            <label class="block text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Last Name</label>
            <p class="text-base sm:text-lg text-gray-900 dark:text-gray-100">{{ currentUser?.lastName }}</p>
          </div>

          <div>
            <label class="block text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Email</label>
            <p class="text-base sm:text-lg text-gray-900 dark:text-gray-100 break-all">{{ currentUser?.email }}</p>
          </div>

          <div>
            <label class="block text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Mobile</label>
            <p class="text-base sm:text-lg text-gray-900 dark:text-gray-100">{{ currentUser?.mobile }}</p>
          </div>

          <div>
            <label class="block text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Username</label>
            <p class="text-base sm:text-lg text-gray-900 dark:text-gray-100">{{ currentUser?.username }}</p>
          </div>

          <div>
            <label class="block text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Member Since</label>
            <p class="text-base sm:text-lg text-gray-900 dark:text-gray-100">{{ currentUser?.createdAt | date:'mediumDate' }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- API Keys Card -->
    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-4 sm:p-6">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0 mb-4 sm:mb-6">
        <div>
          <h2 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-gray-100">API Keys</h2>
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1">
            Manage your API keys ({{ userKeys.length }}/5)
          </p>
        </div>
        <button
          (click)="openAddKeyModal()"
          [disabled]="!canAddMoreKeys()"
          class="w-full sm:w-auto px-4 py-2 text-sm font-semibold bg-jio-blue-500 text-white rounded-lg hover:bg-jio-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors dark:bg-jio-blue-600 dark:hover:bg-jio-blue-500 dark:disabled:bg-gray-700 flex items-center justify-center gap-2"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg>
          Add New Key
        </button>
      </div>

      <!-- Keys Table -->
      <div *ngIf="userKeys.length > 0" class="overflow-x-auto -mx-4 sm:mx-0">
        <div class="inline-block min-w-full align-middle px-4 sm:px-0">
          <table class="min-w-full w-full">
            <thead>
              <tr class="border-b border-gray-200 dark:border-gray-700">
                <th class="text-left py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Key Name</th>
                <th class="text-left py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">API Key</th>
                <th class="text-left py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Created</th>
                <th class="text-right py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let key of userKeys"
                class="border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"
              >
                <td class="py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm text-gray-900 dark:text-gray-100 font-medium">
                  {{ key.name }}
                </td>
                <td class="py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm font-mono text-gray-600 dark:text-gray-400">
                  {{ getObfuscatedKey(key.key) }}
                </td>
                <td class="py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm text-gray-600 dark:text-gray-400">
                  {{ key.createdAt | date:'short' }}
                </td>
                <td class="py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm">
                <div class="flex items-center justify-end gap-1">
                  <button
                    (click)="openEditKeyModal(key)"
                    class="p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors"
                    title="Edit key name"
                  >
                    <svg class="w-4 h-4 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                  </button>
                  <button
                    (click)="downloadKey(key)"
                    class="p-1.5 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors"
                    title="Download key"
                  >
                    <svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                  </button>
                  <button
                    (click)="deleteKey(key.id)"
                    [disabled]="!canDeleteKey()"
                    [class]="canDeleteKey()
                      ? 'p-1.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors cursor-pointer'
                      : 'p-1.5 rounded transition-colors cursor-not-allowed opacity-40'"
                    [title]="canDeleteKey() ? 'Delete key' : 'Cannot delete the last key'"
                  >
                    <svg
                      [class]="canDeleteKey() ? 'w-4 h-4 text-red-600 dark:text-red-400' : 'w-4 h-4 text-gray-400 dark:text-gray-600'"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                  </button>
                </div>
              </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="userKeys.length === 0" class="text-center py-12">
        <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
        </svg>
        <p class="text-gray-500 dark:text-gray-400">No API keys yet. Add your first key to get started.</p>
      </div>
    </div>
  </div>

  <!-- Add Key Modal -->
  <div *ngIf="showAddKeyModal" class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center z-50 p-4">
    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-md w-full">
      <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
        <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Add New API Key</h3>
        <button
          (click)="closeAddKeyModal()"
          class="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors"
        >
          <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div class="p-6">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Key Name <span class="text-xs text-gray-500 dark:text-gray-400">(Optional)</span>
        </label>
        <input
          type="text"
          [(ngModel)]="newKeyName"
          class="input"
          placeholder="e.g., Production Key, Development Key"
          (keyup.enter)="addKey()"
        />
        <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
          If left empty, a default name will be assigned.
        </p>
      </div>

      <div class="flex justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700">
        <button
          (click)="closeAddKeyModal()"
          class="px-4 py-2 text-sm text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
        >
          Cancel
        </button>
        <button
          (click)="addKey()"
          class="px-4 py-2 text-sm bg-jio-blue-500 text-white rounded-lg hover:bg-jio-blue-600 transition-colors dark:bg-jio-blue-600 dark:hover:bg-jio-blue-500"
        >
          Create Key
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Key Name Modal -->
  <div *ngIf="showEditKeyModal" class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center z-50 p-4">
    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-md w-full">
      <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
        <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Edit Key Name</h3>
        <button
          (click)="closeEditKeyModal()"
          class="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors"
        >
          <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div class="p-6">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Key Name
        </label>
        <input
          type="text"
          [(ngModel)]="editingKeyName"
          class="input"
          placeholder="Enter key name"
          (keyup.enter)="updateKeyName()"
        />
      </div>

      <div class="flex justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700">
        <button
          (click)="closeEditKeyModal()"
          class="px-4 py-2 text-sm text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
        >
          Cancel
        </button>
        <button
          (click)="updateKeyName()"
          [disabled]="!editingKeyName.trim()"
          class="px-4 py-2 text-sm bg-jio-blue-500 text-white rounded-lg hover:bg-jio-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors dark:bg-jio-blue-600 dark:hover:bg-jio-blue-500 dark:disabled:bg-gray-700"
        >
          Update
        </button>
      </div>
    </div>
  </div>
</div>
